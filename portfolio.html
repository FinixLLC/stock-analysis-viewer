<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Monitor - Top Gainers & Sell Signals</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .positive {
            color: #10b981;
            font-weight: bold;
        }

        .negative {
            color: #ef4444;
            font-weight: bold;
        }

        .signal-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .signal-high {
            background: #fee2e2;
            color: #dc2626;
        }

        .signal-medium {
            background: #fef3c7;
            color: #d97706;
        }

        .signal-low {
            background: #dbeafe;
            color: #2563eb;
        }

        .signal-none {
            background: #d1fae5;
            color: #059669;
        }

        .symbol-link {
            color: #2563eb;
            text-decoration: none;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .symbol-link:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #666;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: white;
            transform: translateX(-5px);
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #666;
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .rank-badge {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            color: white;
        }

        .rank-1 { background: #fbbf24; }
        .rank-2 { background: #9ca3af; }
        .rank-3 { background: #fb923c; }
        .rank-other { background: #60a5fa; }

        .signal-list {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .signal-item {
            display: block;
            margin: 2px 0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>

        <header>
            <h1>üìä Portfolio Monitor</h1>
            <p class="subtitle">Real-time tracking of 228 positions across NYSE, NASDAQ, and AMEX</p>
            <p class="timestamp" id="lastUpdate">Loading...</p>
        </header>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="totalPositions">-</div>
                <div class="stat-label">Total Positions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value positive" id="avgReturn">-</div>
                <div class="stat-label">Avg 1M Return</div>
            </div>
            <div class="stat-card">
                <div class="stat-value negative" id="sellSignals">-</div>
                <div class="stat-label">Sell Alerts</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topGainer">-</div>
                <div class="stat-label">Top Gainer</div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">üöÄ Top 10 Gainers (1 Month)</h2>
            <div class="table-container">
                <table id="gainersTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Symbol</th>
                            <th>Price</th>
                            <th>1M Return</th>
                            <th>3M Return</th>
                            <th>6M Return</th>
                            <th>1Y Return</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="gainersBody">
                        <tr><td colspan="8" class="loading">Loading data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">üìâ Top 10 Losers (1 Month)</h2>
            <div class="table-container">
                <table id="losersTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Symbol</th>
                            <th>Price</th>
                            <th>1M Return</th>
                            <th>3M Return</th>
                            <th>Sell Signals</th>
                            <th>Alert Level</th>
                        </tr>
                    </thead>
                    <tbody id="losersBody">
                        <tr><td colspan="7" class="loading">Loading data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">‚ö†Ô∏è Critical Sell Alerts (3+ Signals)</h2>
            <div class="table-container">
                <table id="alertsTable">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Price</th>
                            <th>1M Return</th>
                            <th>Signals</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="alertsBody">
                        <tr><td colspan="5" class="loading">Loading data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function loadPortfolioData() {
            try {
                const response = await fetch('portfolio-summary.json');
                if (!response.ok) {
                    throw new Error('Failed to load portfolio data');
                }

                const data = await response.json();
                updateStats(data);
                updateGainersTable(data.top_gainers);
                updateLosersTable(data.top_losers);
                updateAlertsTable(data.sell_alerts);

                document.getElementById('lastUpdate').textContent =
                    `Last Updated: ${new Date(data.generated_at).toLocaleString()}`;
            } catch (error) {
                console.error('Error loading portfolio data:', error);
                showError('Failed to load portfolio data. Please try again later.');
            }
        }

        function updateStats(data) {
            document.getElementById('totalPositions').textContent = data.total_positions;
            document.getElementById('avgReturn').textContent = `+${data.avg_1m_return.toFixed(2)}%`;
            document.getElementById('sellSignals').textContent = data.sell_signal_count;
            document.getElementById('topGainer').textContent = `${data.top_gainer.symbol} +${data.top_gainer.return_1m.toFixed(0)}%`;
        }

        function updateGainersTable(gainers) {
            const tbody = document.getElementById('gainersBody');
            tbody.innerHTML = '';

            gainers.forEach((stock, index) => {
                const row = tbody.insertRow();
                const rankBadge = getRankBadge(index + 1);

                row.innerHTML = `
                    <td>${rankBadge}</td>
                    <td><a href="https://finance.yahoo.com/quote/${stock.symbol}" class="symbol-link" target="_blank">${stock.symbol}</a></td>
                    <td>${formatPrice(stock.price)}</td>
                    <td class="positive">+${stock.return_1m.toFixed(2)}%</td>
                    <td class="${stock.return_3m >= 0 ? 'positive' : 'negative'}">${formatReturn(stock.return_3m)}</td>
                    <td class="${stock.return_6m >= 0 ? 'positive' : 'negative'}">${formatReturn(stock.return_6m)}</td>
                    <td class="${stock.return_1y >= 0 ? 'positive' : 'negative'}">${formatReturn(stock.return_1y)}</td>
                    <td>${getStatusBadge(stock.signal_count)}</td>
                `;
            });
        }

        function updateLosersTable(losers) {
            const tbody = document.getElementById('losersBody');
            tbody.innerHTML = '';

            losers.forEach((stock, index) => {
                const row = tbody.insertRow();

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><a href="https://finance.yahoo.com/quote/${stock.symbol}" class="symbol-link" target="_blank">${stock.symbol}</a></td>
                    <td>${formatPrice(stock.price)}</td>
                    <td class="negative">${stock.return_1m.toFixed(2)}%</td>
                    <td class="${stock.return_3m >= 0 ? 'positive' : 'negative'}">${formatReturn(stock.return_3m)}</td>
                    <td>${stock.signal_count}</td>
                    <td>${getAlertBadge(stock.signal_count)}</td>
                `;
            });
        }

        function updateAlertsTable(alerts) {
            const tbody = document.getElementById('alertsBody');
            tbody.innerHTML = '';

            if (alerts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #10b981;">‚úÖ No critical alerts - all positions looking healthy!</td></tr>';
                return;
            }

            alerts.forEach(stock => {
                const row = tbody.insertRow();

                const signalDetails = stock.signals.slice(0, 3).map(s =>
                    `<span class="signal-item">‚Ä¢ ${s}</span>`
                ).join('');

                row.innerHTML = `
                    <td><a href="https://finance.yahoo.com/quote/${stock.symbol}" class="symbol-link" target="_blank">${stock.symbol}</a></td>
                    <td>${formatPrice(stock.price)}</td>
                    <td class="${stock.return_1m >= 0 ? 'positive' : 'negative'}">${formatReturn(stock.return_1m)}</td>
                    <td>${getAlertBadge(stock.signal_count)}</td>
                    <td><div class="signal-list">${signalDetails}</div></td>
                `;
            });
        }

        function formatPrice(price) {
            return price ? `$${price.toFixed(2)}` : 'N/A';
        }

        function formatReturn(value) {
            if (!value && value !== 0) return 'N/A';
            const sign = value >= 0 ? '+' : '';
            return `${sign}${value.toFixed(2)}%`;
        }

        function getRankBadge(rank) {
            const className = rank <= 3 ? `rank-${rank}` : 'rank-other';
            return `<span class="rank-badge ${className}">${rank}</span>`;
        }

        function getStatusBadge(signalCount) {
            if (signalCount === 0) {
                return '<span class="signal-badge signal-none">‚úÖ Clean</span>';
            } else if (signalCount >= 3) {
                return `<span class="signal-badge signal-high">üö® ${signalCount} signals</span>`;
            } else {
                return `<span class="signal-badge signal-medium">‚ö†Ô∏è ${signalCount} signals</span>`;
            }
        }

        function getAlertBadge(signalCount) {
            if (signalCount >= 5) {
                return '<span class="signal-badge signal-high">üö® Critical (5+)</span>';
            } else if (signalCount >= 3) {
                return '<span class="signal-badge signal-medium">‚ö†Ô∏è High (3-4)</span>';
            } else {
                return '<span class="signal-badge signal-low">‚ÑπÔ∏è Medium (1-2)</span>';
            }
        }

        function showError(message) {
            const container = document.querySelector('.container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            container.insertBefore(errorDiv, container.firstChild);
        }

        // Load data on page load
        loadPortfolioData();

        // Refresh every 5 minutes
        setInterval(loadPortfolioData, 5 * 60 * 1000);
    </script>
</body>
</html>
